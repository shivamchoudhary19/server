# Test failures in fast_alter_partition_table.
#
# Bug#53676: Unexpected errors and possible table corruption on
# ADD PARTITION and LOCK TABLE
# Bug#53770: Server crash at handler.cc:2076 on LOAD DATA
# after timed out COALESCE PARTITION
# Extended crash recovery testing of fast_alter_partition_table.
call mtr.add_suppression("Crashing at");
call mtr.add_suppression("Failing at");
flush tables;
# Iterating 13 fail-points
set @save_dbug= @@debug_dbug;
# Fail-point 1: fail_add_partition_1
set @@debug_dbug= "+d,fail_add_partition_1";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_1: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_1: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_1: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_1: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 2: fail_add_partition_2
set @@debug_dbug= "+d,fail_add_partition_2";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_2: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_2: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_2: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_2: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 3: fail_add_partition_3
set @@debug_dbug= "+d,fail_add_partition_3";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_3: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_3: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_3: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_3: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 4: fail_alter_partition_alloc_parts
set @@debug_dbug= "+d,fail_alter_partition_alloc_parts";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_alloc_parts: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_alter_partition_alloc_parts: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1041	Out of memory.
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_alloc_parts: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_alter_partition_alloc_parts: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1041	Out of memory.
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 5: fail_alter_partition_add
set @@debug_dbug= "+d,fail_alter_partition_add";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_add: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_alter_partition_add: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_add: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_alter_partition_add: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 6: fail_add_partition_4
set @@debug_dbug= "+d,fail_add_partition_4";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_4: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_4: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_4: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_4: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 7: fail_add_partition_5
set @@debug_dbug= "+d,fail_add_partition_5";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_5: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_5: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_5: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_5: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 8: fail_add_partition_6
set @@debug_dbug= "+d,fail_add_partition_6";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_6: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_6: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_6: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_6: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 9: fail_add_partition_7
set @@debug_dbug= "+d,fail_add_partition_7";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_7: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_7: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_7: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_7: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 10: fail_add_partition_8
set @@debug_dbug= "+d,fail_add_partition_8";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_8: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_8: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_add_partition_8: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_add_partition_8: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 11: fail_alter_partition_binlog_1
set @@debug_dbug= "+d,fail_alter_partition_binlog_1";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_binlog_1: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_alter_partition_binlog_1: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER,MyISAM,1,test,t1,id: 1,MyISAM,1,test,t1,id: 2
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_binlog_1: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_alter_partition_binlog_1: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 12: fail_alter_partition_binlog_2
set @@debug_dbug= "+d,fail_alter_partition_binlog_2";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_binlog_2: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_alter_partition_binlog_2: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER,MyISAM,1,test,t1,id: 1,MyISAM,1,test,t1,id: 2
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_binlog_2: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 ADD PARTITION
(PARTITION p15 VALUES IN (20,21,22,23,24));
ERROR HY000: Unknown error
# d,fail_alter_partition_binlog_2: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Iterating 12 fail-points
set @save_dbug= @@debug_dbug;
# Fail-point 1: fail_drop_partition_1
set @@debug_dbug= "+d,fail_drop_partition_1";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_1: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_1: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_1: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_1: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 2: fail_drop_partition_2
set @@debug_dbug= "+d,fail_drop_partition_2";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_2: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_2: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_2: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_2: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 3: fail_drop_partition_3
set @@debug_dbug= "+d,fail_drop_partition_3";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_3: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_3: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_3: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_3: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 4: fail_drop_partition_4
set @@debug_dbug= "+d,fail_drop_partition_4";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_4: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_4: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_4: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_4: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 5: fail_drop_partition_5
set @@debug_dbug= "+d,fail_drop_partition_5";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_5: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_5: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_5: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_5: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 6: fail_alter_partition_rename_table
set @@debug_dbug= "+d,fail_alter_partition_rename_table";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_rename_table: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_alter_partition_rename_table: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_rename_table: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_alter_partition_rename_table: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 7: fail_drop_partition_6
set @@debug_dbug= "+d,fail_drop_partition_6";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_6: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_6: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_6: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_6: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 8: fail_drop_partition_7
set @@debug_dbug= "+d,fail_drop_partition_7";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_7: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_7: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_7: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_7: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 9: fail_drop_partition_8
set @@debug_dbug= "+d,fail_drop_partition_8";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_8: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_8: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_drop_partition_8: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_drop_partition_8: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 10: fail_alter_partition_binlog_1
set @@debug_dbug= "+d,fail_alter_partition_binlog_1";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_binlog_1: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_alter_partition_binlog_1: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER,MyISAM,1,test,t1,id: 1,MyISAM,1,test,t1,id: 2
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_binlog_1: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_alter_partition_binlog_1: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 11: fail_alter_partition_binlog_2
set @@debug_dbug= "+d,fail_alter_partition_binlog_2";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_binlog_2: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_alter_partition_binlog_2: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER,MyISAM,1,test,t1,id: 1,MyISAM,1,test,t1,id: 2
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_binlog_2: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 DROP PARTITION p10, p20;
ERROR HY000: Unknown error
# d,fail_alter_partition_binlog_2: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Iterating 23 fail-points
set @save_dbug= @@debug_dbug;
# Fail-point 1: fail_change_partition_1
set @@debug_dbug= "+d,fail_change_partition_1";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_1: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_1: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_1: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_1: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 2: fail_change_partition_2
set @@debug_dbug= "+d,fail_change_partition_2";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_2: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_2: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_2: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_2: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 3: fail_change_partition_3
set @@debug_dbug= "+d,fail_change_partition_3";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_3: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_3: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_3: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_3: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 4: fail_alter_partition_alloc_parts
set @@debug_dbug= "+d,fail_alter_partition_alloc_parts";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_alloc_parts: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_alloc_parts: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1041	Out of memory.
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_alloc_parts: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_alloc_parts: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1041	Out of memory.
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 5: fail_alter_partition_add
set @@debug_dbug= "+d,fail_alter_partition_add";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_add: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_add: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_add: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_add: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 6: fail_change_partition_add_parts_1
set @@debug_dbug= "+d,fail_change_partition_add_parts_1";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_add_parts_1: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_add_parts_1: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_add_parts_1: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_add_parts_1: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 7: fail_change_partition_add_parts_2
set @@debug_dbug= "+d,fail_change_partition_add_parts_2";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_add_parts_2: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_add_parts_2: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_add_parts_2: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_add_parts_2: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 8: fail_change_partition_add_parts_3
set @@debug_dbug= "+d,fail_change_partition_add_parts_3";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_add_parts_3: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_add_parts_3: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_add_parts_3: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_add_parts_3: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 9: fail_change_partition_4
set @@debug_dbug= "+d,fail_change_partition_4";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_4: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_4: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_4: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_4: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 10: fail_change_partition_5
set @@debug_dbug= "+d,fail_change_partition_5";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_5: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_5: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_5: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_5: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 11: fail_alter_partition_rename_table
set @@debug_dbug= "+d,fail_alter_partition_rename_table";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_rename_table: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_rename_table: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_rename_table: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_rename_table: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine MyISAM
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 12: fail_alter_partition_rename_to_backup
set @@debug_dbug= "+d,fail_alter_partition_rename_to_backup";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_rename_to_backup: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_rename_to_backup: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_rename_to_backup: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_rename_to_backup: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 13: fail_change_partition_rename_parts_1
set @@debug_dbug= "+d,fail_change_partition_rename_parts_1";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_rename_parts_1: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_rename_parts_1: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_rename_parts_1: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_rename_parts_1: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 14: fail_alter_partition_rename_added_part
set @@debug_dbug= "+d,fail_alter_partition_rename_added_part";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_rename_added_part: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_rename_added_part: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_rename_added_part: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_rename_added_part: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 15: fail_change_partition_rename_parts_2
set @@debug_dbug= "+d,fail_change_partition_rename_parts_2";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_rename_parts_2: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_rename_parts_2: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_rename_parts_2: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_rename_parts_2: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 16: fail_alter_partition_rename_drop_backup
set @@debug_dbug= "+d,fail_alter_partition_rename_drop_backup";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_rename_drop_backup: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_rename_drop_backup: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_rename_drop_backup: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_rename_drop_backup: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 17: fail_change_partition_6
set @@debug_dbug= "+d,fail_change_partition_6";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_6: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_6: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_6: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_6: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 18: fail_change_partition_7
set @@debug_dbug= "+d,fail_change_partition_7";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_7: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_7: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_7: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_7: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 19: fail_change_partition_8
set @@debug_dbug= "+d,fail_change_partition_8";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_8: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_8: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_8: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_8: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 20: fail_change_partition_9
set @@debug_dbug= "+d,fail_change_partition_9";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_9: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_9: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_change_partition_9: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_change_partition_9: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 21: fail_alter_partition_binlog_1
set @@debug_dbug= "+d,fail_alter_partition_binlog_1";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_binlog_1: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_binlog_1: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER,MyISAM,1,test,t1,id: 1,MyISAM,1,test,t1,id: 2
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_binlog_1: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_binlog_1: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
# Fail-point 22: fail_alter_partition_binlog_2
set @@debug_dbug= "+d,fail_alter_partition_binlog_2";
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_binlog_2: BEFORE failure
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_binlog_2: AFTER failure
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
ALTER,MyISAM,1,test,t1,id: 1,MyISAM,1,test,t1,id: 2
DROP TABLE t1;
RESET MASTER;
CREATE TABLE t1 (a INT, b VARCHAR(64))
ENGINE = 'MyISAM'
PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
PARTITION p20 VALUES IN (25,26,27,28,29),
PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
INSERT INTO t1 VALUES
(1, "Original from partition p0"),
(2, "Original from partition p0"),
(3, "Original from partition p0"),
(4, "Original from partition p0"),
(11, "Original from partition p1"),
(12, "Original from partition p1"),
(13, "Original from partition p1"),
(14, "Original from partition p1");
# d,fail_alter_partition_binlog_2: BEFORE failure (under LOCK TABLE)
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
LOCK TABLE t1 WRITE;
ALTER TABLE t1 REORGANIZE PARTITION p10, p20 INTO
(PARTITION p10 VALUES IN (10,11,12,13,14,15,16),
PARTITION p15 VALUES IN (17,18,19,20,21,22,23),
PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
ERROR HY000: Unknown error
# d,fail_alter_partition_binlog_2: AFTER failure (under LOCK TABLE)
show warnings;
Level	Code	Message
Error	1105	Unknown error
db.opt
t1#P#p0#SP#p0sp0.MYD
t1#P#p0#SP#p0sp0.MYI
t1#P#p0#SP#p0sp1.MYD
t1#P#p0#SP#p0sp1.MYI
t1#P#p10#SP#p10sp0.MYD
t1#P#p10#SP#p10sp0.MYI
t1#P#p10#SP#p10sp1.MYD
t1#P#p10#SP#p10sp1.MYI
t1#P#p20#SP#p20sp0.MYD
t1#P#p20#SP#p20sp0.MYI
t1#P#p20#SP#p20sp1.MYD
t1#P#p20#SP#p20sp1.MYI
t1#P#p30#SP#p30sp0.MYD
t1#P#p30#SP#p30sp0.MYI
t1#P#p30#SP#p30sp1.MYD
t1#P#p30#SP#p30sp1.MYI
t1.frm
t1.par
SHOW CREATE TABLE t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) DEFAULT NULL,
  `b` varchar(64) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_swedish_ci
 PARTITION BY LIST (`a`)
SUBPARTITION BY HASH (`a`)
SUBPARTITIONS 2
(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = MyISAM,
 PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = MyISAM,
 PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = MyISAM,
 PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = MyISAM)
SELECT * FROM t1;
a	b
1	Original from partition p0
11	Original from partition p1
12	Original from partition p1
13	Original from partition p1
14	Original from partition p1
2	Original from partition p0
3	Original from partition p0
4	Original from partition p0
UNLOCK TABLES;
DROP TABLE t1;
set @@debug_dbug= @save_dbug;
